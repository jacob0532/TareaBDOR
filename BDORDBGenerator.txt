-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;

CREATE TYPE Persona AS (nombre character varying, cedula integer, apellido1 character varying, apellido2 character varying,
    edad integer);
CREATE TYPE Inventario AS(nombre character varying, cantidad integer, valor integer);
CREATE TYPE CategoriasxProducto AS(nombre character varying,inventario Inventario);

CREATE TABLE IF NOT EXISTS public."Persona"
(
    "Cedula" integer NOT NULL,
    "Nombre" character varying NOT NULL,
    "Apellido1" character varying NOT NULL,
    "Apellido2" character varying,
    "Edad" integer NOT NULL,
    PRIMARY KEY ("Cedula")
);

CREATE TABLE IF NOT EXISTS public."Venta"
(
    "idVentaPK" serial NOT NULL,
    "idEmpleadoFK" integer NOT NULL,
    "idClienteFK" integer NOT NULL,
    total integer NOT NULL,
    PRIMARY KEY ("idVentaPK")
);

CREATE TABLE IF NOT EXISTS public."VentasXProducto"
(
    "idVentasXProducto" serial NOT NULL,
    "idVentasFK" integer NOT NULL,
    "idProductoFK" integer NOT NULL,
    cantidad integer NOT NULL,
    PRIMARY KEY ("idVentasXProducto")
);

CREATE TABLE IF NOT EXISTS public."Proveedor"
(
    "proveedorPK" serial NOT NULL,
    "cedulaJuridica" bigint NOT NULL,
    duenno persona NOT NULL,
    "nombreEmpresa" character varying,
    PRIMARY KEY ("proveedorPK")
);

CREATE TABLE IF NOT EXISTS public."Producto"
(
    "idProductoPK" serial NOT NULL,
    nombre character varying NOT NULL,
    precio integer NOT NULL,
    caracteristicas text,
    categoria CategoriasxProducto,
    PRIMARY KEY ("idProductoPK")
);
/*
CREATE TABLE IF NOT EXISTS public."CategoriasxProducto"
(
    "idCategoriasxProductoPK" serial NOT NULL,
    nombre character varying NOT NULL,
    "idInventarioFK" integer NOT NULL,
    PRIMARY KEY ("idCategoriasxProductoPK")
);
*/
/*
CREATE TABLE IF NOT EXISTS public."Inventario"
(
    "idInventarioPK" serial NOT NULL,
    nombre character varying NOT NULL,
    cantidad integer NOT NULL,
    "fechaDeCompra" date NOT NULL,
    PRIMARY KEY ("idInventarioPK")
);
*/
CREATE TABLE IF NOT EXISTS public."Empleado"
(
    "numeroDeEmpleadoPK" serial NOT NULL,
	"informacion" Persona,
    PRIMARY KEY ("numeroDeEmpleadoPK")
);

CREATE TABLE IF NOT EXISTS public."Cliente"
(
    "clientePK" serial NOT NULL,
	"informacion" Persona,
    "metodoDePago" character varying NOT NULL,
    PRIMARY KEY ("clientePK")
);

ALTER TABLE IF EXISTS public."Venta"
    ADD FOREIGN KEY ("idClienteFK")
    REFERENCES public."Cliente" ("clientePK") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."Venta"
    ADD FOREIGN KEY ("idEmpleadoFK")
    REFERENCES public."Empleado" ("numeroDeEmpleadoPK") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."VentasXProducto"
    ADD FOREIGN KEY ("idProductoFK")
    REFERENCES public."Producto" ("idProductoPK") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."VentasXProducto"
    ADD FOREIGN KEY ("idVentasFK")
    REFERENCES public."Venta" ("idVentaPK") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;

/*
ALTER TABLE IF EXISTS public."Producto"
    ADD FOREIGN KEY ("idProductosFK")
    REFERENCES public."CategoriasxProducto" ("idCategoriasxProductoPK") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;
*/
/*
ALTER TABLE IF EXISTS public."CategoriasxProducto"
    ADD FOREIGN KEY ("idInventarioFK")
    REFERENCES public."Inventario" ("idInventarioPK") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;
*/

END;
